import{g as i,c as a,q as f,r as t,a as l,b as _,s as b,d as C,e as S}from"./assets/subscription-8e220c50.js";import{S as y,b as T}from"./assets/vendor-59e0408b.js";async function g(){const e=i(a.CART_KEY);if(f(e),!e.length){t.cardWrapper.innerHTML=l();return}t.cartProducts.insertAdjacentHTML("beforeend",_(e)),new y(document.querySelector(".cart__products"))}async function h(){localStorage.removeItem(a.CART_KEY),t.cardWrapper.innerHTML=l(),t.cartQuantity.forEach(e=>e.textContent=0)}async function E(){const e=i(a.CART_KEY);console.log(e);const o=e.reduce((n,{price:c})=>n+Number(c),0);console.log(o),t.totalPrice.textContent=`$${Number(o.toFixed(2))}`}async function A(e){const{target:o}=e,n=o.closest(".cart__item-close");if(!n)return;const{id:c}=n.closest(".cart__products-item").dataset,r=i(a.CART_KEY),s=r.findIndex(({_id:m})=>m===c);r.splice(s,1),b(r,a.CART_KEY),t.cartProducts.innerHTML=_(r),new y(document.querySelector(".cart__products")),E(),f(r),r.length||(t.cardWrapper.innerHTML=l(),localStorage.removeItem(a.CART_KEY))}async function L(e,o){const n=o.map(({_id:s})=>({productId:s,amount:1})),c=document.querySelector(".cart__submit-button");return c.disabled=!0,(await C({method:"POST",data:{email:e,products:n}})).data}const p=document.body;async function v(e){e.preventDefault();const o=document.querySelector(".cart__submit-button"),{email:n}=e.currentTarget.elements,c=n.value.trim();if(!c)return;const r=i(a.CART_KEY);try{const s=await L(c,r);T.create(S(s.message),{onShow:d=>{p.classList.add("modal-open"),window.addEventListener("keydown",u=>{u.code==="Escape"&&d.close()}),d.element().querySelector(".checkout__close").onclick=d.close},onClose:d=>{p.classList.remove("modal-open"),window.removeEventListener("keydown",u=>{u.code==="Escape"&&d.close()})}}).show(),t.sendForm.reset(),t.cardWrapper.innerHTML=l(),localStorage.removeItem(a.CART_KEY),t.cartQuantity.forEach(d=>d.textContent=0),o.disabled=!1}catch(s){console.log(s)}}g();t.deleteAllProductsFromCart.addEventListener("click",h);E();t.cartProducts.addEventListener("click",A);t.sendForm.addEventListener("submit",v);
//# sourceMappingURL=commonHelpers.js.map
