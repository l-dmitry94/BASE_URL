import{g as u,c as a,q as f,r as t,a as i,b as _,s as C,d as S,e as A}from"./assets/subscription-48d7f225.js";import{S as y,b as T}from"./assets/vendor-59e0408b.js";async function h(){const e=u(a.CART_KEY);if(f(e),!e.length){t.cardWrapper.innerHTML=i();return}t.cartProducts.insertAdjacentHTML("beforeend",_(e)),new y(document.querySelector(".cart__products"))}async function L(){localStorage.removeItem(a.CART_KEY),t.cardWrapper.innerHTML=i(),t.cartQuantity.forEach(e=>e.textContent=0)}async function E(){const s=u(a.CART_KEY).reduce((n,{price:o})=>n+Number(o),0);t.totalPrice.textContent=`$${Number(s.toFixed(2))}`}async function g(e){const{target:s}=e,n=s.closest(".cart__item-close");if(!n)return;const{id:o}=n.closest(".cart__products-item").dataset,r=u(a.CART_KEY),d=r.findIndex(({_id:m})=>m===o);r.splice(d,1),C(r,a.CART_KEY),t.cartProducts.innerHTML=_(r),new y(document.querySelector(".cart__products")),E(),f(r),r.length||(t.cardWrapper.innerHTML=i(),localStorage.removeItem(a.CART_KEY))}async function v(e,s){const n=s.map(({_id:d})=>({productId:d,amount:1})),o=document.querySelector(".cart__submit-button");return o.disabled=!0,(await S({method:"POST",data:{email:e,products:n}})).data}const p=document.body;async function w(e){e.preventDefault();const s=document.querySelector(".cart__submit-button"),{email:n}=e.currentTarget.elements,o=n.value.trim();if(!o)return;const r=u(a.CART_KEY);try{const d=r.map(({_id:c})=>({productId:c,amount:1}));console.log({emailValue:o,products:d});const b=await v(o,r);T.create(A(b.message),{onShow:c=>{p.classList.add("modal-open"),window.addEventListener("keydown",l=>{l.code==="Escape"&&c.close()}),c.element().querySelector(".checkout__close").onclick=c.close},onClose:c=>{p.classList.remove("modal-open"),window.removeEventListener("keydown",l=>{l.code==="Escape"&&c.close()})}}).show(),t.sendForm.reset(),t.cardWrapper.innerHTML=i(),localStorage.removeItem(a.CART_KEY),t.cartQuantity.forEach(c=>c.textContent=0),s.disabled=!1}catch(d){console.log(d)}}h();t.deleteAllProductsFromCart.addEventListener("click",L);E();t.cartProducts.addEventListener("click",g);t.sendForm.addEventListener("submit",w);
//# sourceMappingURL=commonHelpers.js.map
