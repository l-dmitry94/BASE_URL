import{g as i,c as n,q as f,r as t,a as u,b as _,s as b,d as C,e as S}from"./assets/subscription-5b33a1c9.js";import{S as y,b as A}from"./assets/vendor-59e0408b.js";async function T(){const e=i(n.CART_KEY);if(f(e),!e.length){t.cardWrapper.innerHTML=u();return}t.cartProducts.insertAdjacentHTML("beforeend",_(e)),new y(document.querySelector(".cart__products"))}async function h(){localStorage.removeItem(n.CART_KEY),t.cardWrapper.innerHTML=u(),t.cartQuantity.forEach(e=>e.textContent=0)}async function E(){const o=i(n.CART_KEY).reduce((a,{price:c})=>a+c,0);t.totalPrice.textContent=`$${Number(o.toFixed(2))}`}async function L(e){const{target:o}=e,a=o.closest(".cart__item-close");if(!a)return;const{id:c}=a.closest(".cart__products-item").dataset,r=i(n.CART_KEY),s=r.findIndex(({_id:m})=>m===c);r.splice(s,1),b(r,n.CART_KEY),t.cartProducts.innerHTML=_(r),new y(document.querySelector(".cart__products")),E(),f(r),r.length||(t.cardWrapper.innerHTML=u(),localStorage.removeItem(n.CART_KEY))}async function g(e,o){const a=o.map(({_id:s})=>({productId:s,amount:1})),c=document.querySelector(".cart__submit-button");return c.disabled=!0,(await C({method:"POST",data:{email:e,products:a}})).data}const p=document.body;async function v(e){e.preventDefault();const o=document.querySelector(".cart__submit-button"),{email:a}=e.currentTarget.elements,c=a.value.trim();if(!c)return;const r=i(n.CART_KEY);try{const s=await g(c,r);A.create(S(s.message),{onShow:d=>{p.classList.add("modal-open"),window.addEventListener("keydown",l=>{l.code==="Escape"&&d.close()}),d.element().querySelector(".checkout__close").onclick=d.close},onClose:d=>{p.classList.remove("modal-open"),window.removeEventListener("keydown",l=>{l.code==="Escape"&&d.close()})}}).show(),t.sendForm.reset(),t.cardWrapper.innerHTML=u(),localStorage.removeItem(n.CART_KEY),t.cartQuantity.forEach(d=>d.textContent=0),o.disabled=!1}catch(s){console.log(s)}}T();t.deleteAllProductsFromCart.addEventListener("click",h);E();t.cartProducts.addEventListener("click",L);t.sendForm.addEventListener("submit",v);
//# sourceMappingURL=commonHelpers.js.map
