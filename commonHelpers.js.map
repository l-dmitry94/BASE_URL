{"version":3,"file":"commonHelpers.js","sources":["../src/js/cart/cart.js","../src/js/cart/delete-from-cart.js","../src/js/cart/general-sum.js","../src/js/cart/delete-product.js","../src/js/requests/orders.js","../src/js/cart/send-products.js","../src/cart.js"],"sourcesContent":["import SimpleBar from 'simplebar';\nimport 'simplebar/dist/simplebar.css';\n\nimport { common } from '../common/common';\nimport { quantityProduct } from '../helpers/helpers';\nimport { createMarkupCartList, createMarkupEmptyCart } from '../services/markup';\nimport { refs } from '../services/refs';\nimport { getData } from '../services/storage';\n\nexport async function handleCart() {\n    const cartArr = getData(common.CART_KEY);\n    \n    quantityProduct(cartArr);\n\n    if (!cartArr.length) {\n        refs.cardWrapper.innerHTML = createMarkupEmptyCart();\n        return\n    }\n\n    refs.cartProducts.insertAdjacentHTML(\"beforeend\", createMarkupCartList(cartArr));\n\n    new SimpleBar(document.querySelector(\".cart__products\"));\n\n}\n\n\n","import { common } from \"../common/common\";\nimport { quantityProduct } from \"../helpers/helpers\";\nimport { createMarkupEmptyCart } from \"../services/markup\";\nimport { refs } from \"../services/refs\";\n\nexport async function handleDeleteAllFromCart() {\n\n    localStorage.removeItem(common.CART_KEY)\n    \n    refs.cardWrapper.innerHTML = createMarkupEmptyCart();\n\n    refs.cartQuantity.forEach(item => item.textContent = 0)\n\n} ","import { common } from \"../common/common\";\nimport { refs } from \"../services/refs\";\nimport { getData } from \"../services/storage\";\n\nexport async function generalSum() {\n    const cartArr = getData(common.CART_KEY);\n\n    \n    const totalSum = cartArr.reduce((total, {price}) => {\n        return total + Number(price);\n    }, 0)\n\n\n    refs.totalPrice.textContent = `$${Number(totalSum.toFixed(2))}`\n}","import SimpleBar from 'simplebar';\nimport 'simplebar/dist/simplebar.css';\n\nimport { common } from \"../common/common\";\nimport { quantityProduct } from \"../helpers/helpers\";\nimport { createMarkupCartList, createMarkupEmptyCart } from \"../services/markup\";\nimport { refs } from \"../services/refs\";\nimport { getData, saveData } from \"../services/storage\";\nimport { generalSum } from \"./general-sum\";\n\nexport async function handleDeleteProduct(event) {\n    const { target } = event;\n\n    const deleteBtn = target.closest(\".cart__item-close\");\n\n    if(!deleteBtn) {\n        return\n    }\n\n    const {id} = deleteBtn.closest(\".cart__products-item\").dataset;\n\n    const cartArr = getData(common.CART_KEY);\n\n    const findProductIndex = cartArr.findIndex(({_id}) => _id === id)\n\n    cartArr.splice(findProductIndex, 1);\n\n    saveData(cartArr, common.CART_KEY)\n\n    refs.cartProducts.innerHTML = createMarkupCartList(cartArr)\n\n    new SimpleBar(document.querySelector(\".cart__products\"));\n\n    generalSum();\n\n    quantityProduct(cartArr);\n\n    if(!cartArr.length) {\n        refs.cardWrapper.innerHTML = createMarkupEmptyCart();\n        localStorage.removeItem(common.CART_KEY)\n    }\n}\n","import { apiOrders } from '../services/api';\n\nexport async function fetchSendOrder(email, arr) {\n    const products = arr.map(({ _id }) => ({ productId: _id, amount: 1 }));\n    \n    const submitBtn = document.querySelector(\".cart__submit-button\");\n\n    submitBtn.disabled = true;\n\n    const response = await apiOrders({\n        method: 'POST',\n        data: {\n            email: email,\n            products: products,\n        },\n    });\n\n    return response.data;\n}\n","import * as basicLightbox from 'basiclightbox';\nimport 'basiclightbox/dist/basicLightbox.min.css';\n\nimport { common } from '../common/common';\nimport { fetchSendOrder } from '../requests/orders';\nimport { getData } from '../services/storage';\nimport {\n    createMarkupEmptyCart,\n    createMarkupSuccessOrder,\n} from '../services/markup';\nimport { refs } from '../services/refs';\n\nconst body = document.body;\n\nexport async function handleSendProducts(event) {\n    event.preventDefault();\n\n    const submitBtn = document.querySelector('.cart__submit-button');\n\n    const { email } = event.currentTarget.elements;\n\n    const emailValue = email.value.trim();\n\n    if (!emailValue) {\n        return;\n    }\n\n    const cartArr = getData(common.CART_KEY);\n    try {\n        const products = cartArr.map(({ _id }) => ({ productId: _id, amount: 1 }));\n\n        const orders = {\n            emailValue,\n            products,\n        }\n\n        console.log(orders)\n\n        const data = await fetchSendOrder(emailValue, cartArr);\n\n        const instance = basicLightbox.create(\n            createMarkupSuccessOrder(data.message),\n            {\n                onShow: instance => {\n                    body.classList.add('modal-open');\n                    window.addEventListener('keydown', event => {\n                        if (event.code === 'Escape') {\n                            instance.close();\n                        }\n                    });\n                    instance\n                        .element()\n                        .querySelector('.checkout__close').onclick =\n                        instance.close;\n                },\n                onClose: instance => {\n                    body.classList.remove('modal-open');\n                    window.removeEventListener('keydown', event => {\n                        if (event.code === 'Escape') {\n                            instance.close();\n                        }\n                    });\n                },\n            }\n        );\n\n        instance.show();\n\n        refs.sendForm.reset();\n\n        refs.cardWrapper.innerHTML = createMarkupEmptyCart();\n\n        localStorage.removeItem(common.CART_KEY);\n\n        refs.cartQuantity.forEach(item => (item.textContent = 0));\n\n        submitBtn.disabled = false;\n    } catch (error) {\n        console.log(error);\n    }\n}\n","import { handleCart } from './js/cart/cart';\nimport { handleDeleteAllFromCart } from './js/cart/delete-from-cart';\nimport { handleDeleteProduct } from './js/cart/delete-product';\nimport { generalSum } from './js/cart/general-sum';\nimport { handleSendProducts } from './js/cart/send-products';\nimport { refs } from './js/services/refs';\nimport './js/requests/subscription';\n\nhandleCart();\n\nrefs.deleteAllProductsFromCart.addEventListener(\n    'click',\n    handleDeleteAllFromCart\n);\n\ngeneralSum();\n\nrefs.cartProducts.addEventListener('click', handleDeleteProduct);\n\nrefs.sendForm.addEventListener('submit', handleSendProducts);\n"],"names":["handleCart","cartArr","getData","common","quantityProduct","refs","createMarkupEmptyCart","createMarkupCartList","SimpleBar","handleDeleteAllFromCart","item","generalSum","totalSum","total","price","handleDeleteProduct","event","target","deleteBtn","id","findProductIndex","_id","saveData","fetchSendOrder","email","arr","products","submitBtn","apiOrders","body","handleSendProducts","emailValue","data","basicLightbox.create","createMarkupSuccessOrder","instance","error"],"mappings":"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"}