import{f as $,h as I,r as t,i as C,j as R,k as B,g as v,c as m,l as g,m as K,n as Y,s as k,o as F,p as w,t as b,u as D,v as y,w as x,x as M,y as j,z as P,A as N,B as O,q as z}from"./assets/subscription-710678c0.js";import{b as J,S as V,c as G,P as H}from"./assets/vendor-59e0408b.js";$().then(o=>{let s=I(o.slice(0,2));t.discountCards.innerHTML=s,C()}).catch;R().then(o=>{let s=B(o.slice(0,5));t.popularCards.innerHTML=s,C()}).catch;const S=v(m.CART_KEY);async function q(o){const{target:s}=o,a=s.closest(".cards__button");if(!a)return;console.log(a);const{id:i}=a.closest(".cards__item").dataset,e=a.closest(".cards__item"),d=[...e.querySelectorAll(".cards__info-value")].map(r=>r),h=e.querySelector("[data-category]"),n=e.querySelector(".cards__price"),c=n?n.textContent:"",l={_id:i,category:h.dataset.category?h.dataset.category:"",img:e.querySelector(".cards__image-photo-js").src?e.querySelector(".cards__image-photo-js").src:"",name:e.querySelector(".cards__title").textContent?e.querySelector(".cards__title").textContent:"",popularity:d[2].textContent?d[2].textContent:"",price:Number(c.slice(1))?Number(c.slice(1)):"",size:d[1].textContent?d[1].textContent:""};if(console.log(!!l),S.some(({_id:r})=>i===r))return;S.push(l);const _=document.querySelector(".header__menu-link-quantity");_.textContent=S.length,localStorage.setItem(m.CART_KEY,JSON.stringify(S)),S.forEach(({_id:r})=>{document.querySelectorAll(`[data-id="${r}"]`).forEach(E=>{const L=E.querySelector(".cards__button");L.innerHTML=`<svg class="icon-checked"><use href="${g}#icon-check"></use></svg>`})})}const T=document.body;async function A(o){o.preventDefault();const{target:s}=o,a=s.closest(".cards__button"),i=s.closest(".cards__link");if(a||!i)return;const{id:e}=i.closest(".cards__item").dataset,f=await K(e),d=n=>{const c=v(m.CART_KEY);if(c.find(({_id:u})=>e===u)){const u=c.findIndex(({_id:p})=>p===e);u!==-1&&c.splice(u,1);const _=document.querySelector(".header__menu-link-quantity");_.textContent=c.length,k(c,m.CART_KEY),c.length||localStorage.removeItem(m.CART_KEY),document.querySelectorAll(`[data-id="${e}"] .cards__button`).forEach(p=>{p.innerHTML=`<svg class="icon__cart" width="18" height="18"><use href="${g}#icon-cart"></use></svg>`,p.closest(".popular__item")&&(p.innerHTML=`<svg class="cart-green" width="18" height="18"><use href="${g}#icon-cart"></use></svg>`)}),n.innerHTML=`Add to <svg class="icon__cart" width="18" height="18"><use href="${g}#icon-cart"></use></svg>`}else{if(c.some(({_id:r})=>e===r))return;c.push(f);const _=document.querySelector(".header__menu-link-quantity");_.textContent=c.length,k(c,m.CART_KEY),c.forEach(({_id:r})=>{document.querySelectorAll(`[data-id="${r}"]`).forEach(E=>{const L=E.querySelector(".cards__button");L.innerHTML=`<svg class="icon-checked"><use href="${g}#icon-check"></use></svg>`})}),n.innerHTML=`Remove from <svg class="icon__cart" width="18" height="18"><use href="${g}#icon-cart"></use></svg>`}};J.create(Y(f),{onShow:n=>{T.classList.add("modal-open"),window.addEventListener("keydown",r=>{r.code==="Escape"&&n.close()});const l=n.element().querySelector(".modal__item").querySelector(".cards__button");v(m.CART_KEY).find(({_id:r})=>r===e)?l.innerHTML=`Remove from <svg class="icon__cart" width="18" height="18"><use href="${g}#icon-cart"></use></svg>`:l.innerHTML=`Add to <svg class="icon__cart" width="18" height="18"><use href="${g}#icon-cart"></use></svg>`,l.addEventListener("click",()=>d(l)),C(),n.element().querySelector(".modal__item-close").onclick=n.close},onClose:n=>{T.classList.remove("modal-open"),window.removeEventListener("keydown",u=>{u.code==="Escape"&&n.close()});const l=n.element().querySelector(".modal__item").querySelector(".cards__button");l.removeEventListener("click",()=>d(l))}}).show(),new V(document.querySelector(".cards__desc-modal"))}F().then(o=>{let s=o.map(e=>w(e));localStorage.setItem("filter",b);let a=s.map(e=>`<option value="${e}">${w(e)}</option>`).join(""),i="<option  selected  >Show all</option>";t.productsFiltersSelect.innerHTML=a+i,new G({select:t.productsFiltersSelect,showSearch:!1})}).catch;D().then(o=>{console.log(y);let s=x(o.results);t.productsCards.innerHTML=s,y.totalItems=o.perPage*o.totalPages,new H(M,y).on("beforeMove",j),C()}).catch();t.productsFiltersSelect.addEventListener("change",P);t.btnSubmit.addEventListener("submit",N);t.productsFiltersSelect.addEventListener("change",P);const Q=new H(M,y);Q.on("beforeMove",o=>{const s=o.page,a=t.productsFiltersSelect.options[t.productsFiltersSelect.selectedIndex];let i=localStorage.getItem("filter"),e=i?JSON.parse(i):{};const f=a.textContent!=="Show all"?a.textContent:null;e.category=f;let d=b;e.page=s,localStorage.setItem("filter",JSON.stringify(e)),e.keyword===null&&e.category===null&&O(s,e.limit).then(h=>{let n=x(h.results);console.log(e.page),localStorage.setItem("filter",d),t.productsCards.innerHTML=n}).catch(h=>{console.error(h)})});t.productsCards.addEventListener("click",q);t.popularCards.addEventListener("click",q);t.discountCards.addEventListener("click",q);const U=v(m.CART_KEY);z(U);t.productsCards.addEventListener("click",A);t.popularCards.addEventListener("click",A);t.discountCards.addEventListener("click",A);
//# sourceMappingURL=commonHelpers2.js.map
