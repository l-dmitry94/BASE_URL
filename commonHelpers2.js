import{f as $,h as I,r as o,i as C,j as R,k as B,g as v,c as _,l as m,m as K,n as Y,s as A,o as F,p as k,t as T,u as D,v as y,w as b,x,y as j,z as M,A as N,B as O,q as z}from"./assets/subscription-d1388f9b.js";import{b as J,S as V,c as G,P}from"./assets/vendor-59e0408b.js";$().then(c=>{let s=I(c.slice(0,2));o.discountCards.innerHTML=s,C()}).catch;R().then(c=>{let s=B(c.slice(0,5));o.popularCards.innerHTML=s,C()}).catch;const f=v(_.CART_KEY);async function E(c){const{target:s}=c,r=s.closest(".cards__button");if(!r)return;console.log(r);const{id:d}=r.closest(".cards__item").dataset,e=r.closest(".cards__item"),u=[...e.querySelectorAll(".cards__info-value")].map(i=>i),p=e.querySelector("[data-category]"),n=e.querySelector(".cards__price").textContent,t={_id:d,category:p.dataset.category?p.dataset.category:null,img:e.querySelector(".cards__image-photo-js").src?e.querySelector(".cards__image-photo-js").src:null,name:e.querySelector(".cards__title").textContent?e.querySelector(".cards__title").textContent:null,popularity:u[2].textContent?u[2].textContent:null,price:Number(n.slice(1))?Number(n.slice(1)):null,size:u[1].textContent?u[1].textContent:null},a=f.findIndex(i=>i._id===t._id);a!==-1?f[a]=t:f.push(t);const l=document.querySelector(".header__menu-link-quantity");l.textContent=f.length,localStorage.setItem(_.CART_KEY,JSON.stringify(f)),f.forEach(({_id:i})=>{document.querySelectorAll(`[data-id="${i}"]`).forEach(h=>{const L=h.querySelector(".cards__button");L.innerHTML=`<svg class="icon-checked"><use href="${m}#icon-check"></use></svg>`})})}const w=document.body;async function q(c){c.preventDefault();const{target:s}=c,r=s.closest(".cards__button"),d=s.closest(".cards__link");if(r||!d)return;const{id:e}=d.closest(".cards__item").dataset,S=await K(e),u=n=>{const t=v(_.CART_KEY);if(t.find(({_id:l})=>e===l)){const l=t.findIndex(({_id:h})=>h===e);l!==-1&&t.splice(l,1);const i=document.querySelector(".header__menu-link-quantity");i.textContent=t.length,A(t,_.CART_KEY),t.length||localStorage.removeItem(_.CART_KEY),document.querySelectorAll(`[data-id="${e}"] .cards__button`).forEach(h=>{h.innerHTML=`<svg class="icon__cart" width="18" height="18"><use href="${m}#icon-cart"></use></svg>`,h.closest(".popular__item")&&(h.innerHTML=`<svg class="cart-green" width="18" height="18"><use href="${m}#icon-cart"></use></svg>`)}),n.innerHTML=`Add to <svg class="icon__cart" width="18" height="18"><use href="${m}#icon-cart"></use></svg>`}else{if(t.some(({_id:g})=>e===g))return;t.push(S);const i=document.querySelector(".header__menu-link-quantity");i.textContent=t.length,A(t,_.CART_KEY),t.forEach(({_id:g})=>{document.querySelectorAll(`[data-id="${g}"]`).forEach(L=>{const H=L.querySelector(".cards__button");H.innerHTML=`<svg class="icon-checked"><use href="${m}#icon-check"></use></svg>`})}),n.innerHTML=`Remove from <svg class="icon__cart" width="18" height="18"><use href="${m}#icon-cart"></use></svg>`}};J.create(Y(S),{onShow:n=>{w.classList.add("modal-open"),window.addEventListener("keydown",g=>{g.code==="Escape"&&n.close()});const a=n.element().querySelector(".modal__item").querySelector(".cards__button");v(_.CART_KEY).find(({_id:g})=>g===e)?a.innerHTML=`Remove from <svg class="icon__cart" width="18" height="18"><use href="${m}#icon-cart"></use></svg>`:a.innerHTML=`Add to <svg class="icon__cart" width="18" height="18"><use href="${m}#icon-cart"></use></svg>`,a.addEventListener("click",()=>u(a)),C(),n.element().querySelector(".modal__item-close").onclick=n.close},onClose:n=>{w.classList.remove("modal-open"),window.removeEventListener("keydown",l=>{l.code==="Escape"&&n.close()});const a=n.element().querySelector(".modal__item").querySelector(".cards__button");a.removeEventListener("click",()=>u(a))}}).show(),new V(document.querySelector(".cards__desc-modal"))}F().then(c=>{let s=c.map(e=>k(e));localStorage.setItem("filter",T);let r=s.map(e=>`<option value="${e}">${k(e)}</option>`).join(""),d="<option  selected  >Show all</option>";o.productsFiltersSelect.innerHTML=r+d,new G({select:o.productsFiltersSelect,showSearch:!1})}).catch;D().then(c=>{console.log(y);let s=b(c.results);o.productsCards.innerHTML=s,y.totalItems=c.perPage*c.totalPages,new P(x,y).on("beforeMove",j),C()}).catch();o.productsFiltersSelect.addEventListener("change",M);o.btnSubmit.addEventListener("submit",N);o.productsFiltersSelect.addEventListener("change",M);const Q=new P(x,y);Q.on("beforeMove",c=>{const s=c.page,r=o.productsFiltersSelect.options[o.productsFiltersSelect.selectedIndex];let d=localStorage.getItem("filter"),e=d?JSON.parse(d):{};const S=r.textContent!=="Show all"?r.textContent:null;e.category=S;let u=T;e.page=s,localStorage.setItem("filter",JSON.stringify(e)),e.keyword===null&&e.category===null&&O(s,e.limit).then(p=>{let n=b(p.results);console.log(e.page),localStorage.setItem("filter",u),o.productsCards.innerHTML=n}).catch(p=>{console.error(p)})});o.productsCards.addEventListener("click",E);o.popularCards.addEventListener("click",E);o.discountCards.addEventListener("click",E);const U=v(_.CART_KEY);z(U);o.productsCards.addEventListener("click",q);o.popularCards.addEventListener("click",q);o.discountCards.addEventListener("click",q);
//# sourceMappingURL=commonHelpers2.js.map
